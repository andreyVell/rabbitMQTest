# RabbitMQ 
Запустить docker compose up -d 

или 

docker run -d --name rabbitmq-test -p 5672:5672 -p 15672:15672 -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=password --restart unless-stopped rabbitmq:3.12-management

По адресу http://localhost:15672 запустится панель управление сервером rabbitMq

## Типы exchange
1. Direct - Маршрутизирует сообщения в очереди на основе точного совпадения routing key.
2. Fanout - Отправляет сообщения во все привязанные очереди.
3. Topic - Маршрутизирует сообщения в очереди на основе шаблона routing key.
4. Headers - Маршрутизирует сообщения на основе заголовков (headers)

# Сервисы

Перед запуском возможно нужно поправить ссылки на dll Bus.Contract в солюшенах.

У RabbitMQProducer есть 2 метода Get и Set, их можно вызывать посредством UI сваггера. С помощью MassTransit реализовано взаимодействие request - response через шину (Get) и односторонняя передача сообщения (Set).

При запуске серсиса RabbitMQConsumer автоматически создадутся необходимые exchanges и queues, также настряотся биндинги между ними. 

В дальнейшем предполагается что у каждого сервиса будет своя очередь, откуда определённые консюмеры вытягивают сообщения, в зависимости от их типа. Для каждого контракта сообщения создаётся свой fanout exchange который биндится с очередью в соответствии с конфигурацией.

# MassTransit

В MassTransit Все exchange по умолчанию fanout, то есть сообщение из exchange попадёт во все сбинженные очереди. 

## GetResponse() - RespondAsync()
Автоматически создаёт временную очередь для обмена

1. Клиент создает временную очередь для получения ответа. Имя очереди генерируется динамически (например, response-queue-12345).
2. Клиент отправляет запрос в очередь сервера (например, request-queue).
3. В заголовках запроса указывается адрес временной очереди (response-queue-12345), куда нужно отправить ответ.
4. Сервер получает запрос из очереди request-queue.
5. Сервер обрабатывает запрос и отправляет ответ в exchange, связанный с временной очередью клиента (response-queue-12345).
6. Клиент ожидает ответа во временной очереди response-queue-12345.
7. После получения ответа временная очередь удаляется.

## Send() 
Отправляет сообщение в конкретную очередь, конкретному consumer, если очереди нет, она будет создана

## Publish() 
Отправляет в соответстующий контракту сообщения exchange, откуда оно попадает во все сбинженные очереди